# Введение #

Часто имеющиеся плагины не реализуют желаемых функций. Конечно, можно заказать новую функциональность, но реализацию можно ждать долго, либо реализация будет не совсем соответствовать заявке. Что делать? - Писать свой плагин.

# Простейший плагин #

В принципе, простейший плагин - это фрагмент JavaScript кода, не выполняющий никаких действий. Но такой плагин никому не нужен. Вот как выглядит скелет стандартного подключаемого модуля:
```
(function(){
  return {
    parameterNumber: 12345,
    parameterString: "qwerty",
    parameterBool: true,
    toString: function() { // Название плагина
      return "Простейший плагин";
    },
    getProperties: function() { // запрос конфигурируемых параметров
      return [
        {name:"Параметр 1", value:this.parameterNumber},
        {name:"Параметр 2", value:this.parameterString},
        {name:"Параметр 3", value:this.parameterBool}
      ];
    },
    setProperties: function(a) { // применение изменённых настроек
      this.parameterNumber = a[0].value;
      this.parameterString = a[1].value;
      this.parameterBool = a[2].value;
    },
    Init: function() {
      return this;
    }
  }.Init();
})()
```

Вызов анонимной функции гарантирует, что процесс инициализации плагина не оставит после себя каких-либо артефактов, а также гарантирует, что локальные переменные не пересекутся с уже объявленными ранее переменными и членами объекта _top_.

Функции-члены toString, getProperties, setProperties - опциональны (их можно опустить) и выполняют следующие задачи:
  * _toString_ - позволяет отображать имя плагина в списке плагинов в настройках Менеджера
  * _getProperties_ - признак того, что плагин конфигурируемый, возвращает массив объектов для настройки своих параметров пользователем
  * _setProperties_ - признак того, что плагин может применять отредактированные пользователем настройки

Функция-член _Init_ упрощает процедуру инициализации плагина, позволяя написать код "в одну строку", без создания локальных переменных.

Для доступа к объекту менеджера плагинов следует использовать выражение _top.combats\_plugin\_manager_, который реализует следующие свойства и методы:
  * _getMainFrame()_ - возвращает объект основного фрейма игрового окна, того самого, где открывается инвентарь, где просматриваются заявки на поединки, где отображаются игровые локации
  * _add\_chat(s)_ - выводит сообщения, заданные строкой _s_ в чат, сообщения должны быть разделены тэгом 

&lt;BR&gt;


  * _getHTTPRequest()_ - возвращает объект XMLHttpRequest
  * _attachEvent(event, method)_ - позволяет подключить обработчик событий _method_ на событие с именем _event_
  * _detachEvent(event, method)_ - отключить обработчик событий _method_ от события с именем _event_
  * _fireEvent(event, eventObj)_ - генерирует событие с именем _event_, передавая в обработчики объект _eventObj_
  * _get\_binded\_method(obj, method, ...)_ - позволяет создать функцию, привязанную к объекту _obj_, вызов такой функции гарантирует, что при испольнении метода _method_ объект _this_ будет ссылаться на _obj_
  * _addLog(message)_ - заносит в журнал событий текст, заданные параметром _message_
  * _logError(plugin,e)_ - заносит в журнал событий информацию об ошибке _e_ в плагине _plugin_, опционально сообщение может быть отображено в чате, если это разрешено в  настройках менеджера